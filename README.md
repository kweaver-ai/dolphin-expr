# Dolphin Language å®éªŒç³»ç»Ÿ

æœ¬å®éªŒç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç»“æ„åŒ–çš„æ–¹å¼æ¥è¿è¡Œå’Œç®¡ç† Dolphin Language ç¨‹åºçš„å®éªŒï¼Œæ”¯æŒé…ç½®å¯¹æ¯”ã€åŸºå‡†æµ‹è¯•ã€å˜é‡è¿½è¸ªå’Œå¤§è§„æ¨¡è‡ªåŠ¨åŒ–å®éªŒã€‚

## ç›®å½•ç»“æ„

```text
experiments/
â”œâ”€â”€ bin/                    # å®éªŒç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ create             # åˆ›å»ºæ–°å®éªŒ
â”‚   â”œâ”€â”€ run               # è¿è¡Œ/ç®¡ç†å®éªŒï¼ˆæ”¯æŒæ¢å¤/çŠ¶æ€/æšä¸¾ï¼‰
â”‚   â””â”€â”€ analyst           # å®éªŒåˆ†æä¾¿æ·å…¥å£ï¼ˆæ€»ä½“/æ‰§è¡Œ/Summaryï¼‰
â”œâ”€â”€ design/               # å®éªŒè®¾è®¡åŒºåŸŸ
â”‚   â””â”€â”€ [experiment_name]/
â”‚       â”œâ”€â”€ spec.txt      # å®éªŒè§„æ ¼è¯´æ˜
â”‚       â”œâ”€â”€ config/       # é…ç½®æ–‡ä»¶
â”‚       â”œâ”€â”€ dolphins/     # DPH è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ benchmark/             # åŸºå‡†æµ‹è¯•æ•°æ®ç›®å½•
â”‚   â””â”€â”€ [benchmark_name]/  # åŸºå‡†æµ‹è¯•ç›®å½•
â”‚       â”œâ”€â”€ init.py        # åˆå§‹åŒ–é€»è¾‘
â”‚       â”œâ”€â”€ benchmark.json # åŸºå‡†æµ‹è¯•æ•°æ®
â”‚       â””â”€â”€ benchmark.yaml # åŸºå‡†é…ç½®
â”‚       â””â”€â”€ runs/         # ç©ºç›®å½•ï¼Œç”¨äºå­˜æ”¾è¿è¡Œè®°å½•
â”œâ”€â”€ env/                  # å®éªŒè¿è¡Œç¯å¢ƒ
â”‚   â””â”€â”€ [experiment_run_timestamp]/
â”‚       â”œâ”€â”€ spec.txt      # æœ¬æ¬¡è¿è¡Œä½¿ç”¨çš„è§„æ ¼æ–‡ä»¶
â”‚       â””â”€â”€ run_XXX/      # æ¯æ¬¡è¿è¡Œçš„ç‹¬ç«‹ç›®å½•
â”‚           â”œâ”€â”€ run_summary.yaml        # è¯¥è¿è¡Œçš„æ±‡æ€»ç»“æœ
â”‚           â”œâ”€â”€ console/                # æ§åˆ¶å°æ—¥å¿—ï¼ˆcase_XXX.logï¼‰
â”‚           â”œâ”€â”€ profile/                # æ€§èƒ½å‰–æï¼ˆverbose æ¨¡å¼ä¸‹æŒ‰ case æ”¶é›†ï¼‰
â”‚           â”œâ”€â”€ config/
â”‚           â”œâ”€â”€ dolphins/
â”‚           â”œâ”€â”€ history/                # å¯¹è¯å†å²è®°å½•
â”‚           â”‚   â”œâ”€â”€ case_001.jsonl
â”‚           â”‚   â””â”€â”€ case_002.jsonl
â”‚           â””â”€â”€ cmds/                   # å¤ç°å®éªŒçš„å‘½ä»¤è„šæœ¬
â”œâ”€â”€ analyst/              # å®éªŒåˆ†æå·¥å…·
â”‚   â”œâ”€â”€ experiment_analyzer.py  # ä¸»åˆ†æå™¨ç±»
â”‚   â”œâ”€â”€ analyze.py             # ä¾¿æ·å…¥å£è„šæœ¬
â”‚   â””â”€â”€ README.md              # åˆ†æå·¥å…·è¯¦ç»†è¯´æ˜
â”œâ”€â”€ reports/              # åˆ†ææŠ¥å‘Šè¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ [experiment_name]_analysis_[timestamp].txt      # æ–‡æœ¬åˆ†ææŠ¥å‘Š
â”‚   â””â”€â”€ [experiment_name]_analysis_[timestamp]_detailed.csv  # è¯¦ç»†æ•°æ®è¡¨æ ¼
â””â”€â”€ prototype/            # åŸå‹æ¨¡æ¿
    â””â”€â”€ spec.txt          # é»˜è®¤è§„æ ¼æ¨¡æ¿
```

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºå®éªŒ

```bash
# åˆ›å»ºæ–°å®éªŒï¼ŒæŒ‡å®š dolphins æ–‡ä»¶å¤¹
./experiments/bin/create --name my_experiment --dolphins path/to/dolphins_folder
```

### 2. é…ç½®å®éªŒ

ç¼–è¾‘ `experiments/design/my_experiment/spec.txt`ï¼š

```yaml
entrypoints: ["main.dph", "agent_name"]
configs:
  - context_engineer.constraints.max_input_tokens: [64000, 32000]
    vm.host: localhost
variables:
  query: "ç¤ºä¾‹æŸ¥è¯¢"
  thought: "æ€è€ƒè¿‡ç¨‹"
num_samples: 3
sample_method: SEQ
benchmark: "browse_comp"                # åŸºå‡†æµ‹è¯•åç§°ï¼ŒæŒ‡å‘ experiments/benchmark ä¸‹çš„ç›®å½•
num_run_cases: 5                           # å¯é€‰ï¼šé™åˆ¶åŸºå‡†æµ‹è¯•æ¡ˆä¾‹æ•°é‡
output_variables: ["query", "final_result"] # å¯é€‰ï¼šæŒ‡å®šè¦è®°å½•çš„å˜é‡
dolphin_folder: "/path/to/agents"         # å¯é€‰ï¼šæŒ‡å®š Dolphin ä»£ç†æ–‡ä»¶å¤¹è·¯å¾„
threads: 4                               # å¯é€‰ï¼šæŒ‡å®šå¹¶å‘çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º2
```

### 3. è¿è¡Œå®éªŒ

```bash
# è¿è¡Œå®éªŒ
./experiments/bin/run --name my_experiment
```

### 4. è¿è¡Œç®¡ç†ï¼ˆæ¢å¤/çŠ¶æ€/å†å²ï¼‰

- æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡å®éªŒæ‰§è¡ŒçŠ¶æ€ï¼š
  - `./experiments/bin/run --name my_experiment --status`
- åˆ—å‡ºæŸå®éªŒçš„æ‰€æœ‰æ‰§è¡Œç¯å¢ƒï¼š
  - `./experiments/bin/run --name my_experiment --list-envs`
- æŒ‡å®šæ‰§è¡Œç¯å¢ƒï¼ˆæ—¶é—´æˆ³IDï¼‰è¿›è¡Œæ“ä½œï¼š
  - `./experiments/bin/run --name my_experiment --env-id my_experiment_20250828_052443 --status`
- ä»æŒ‡å®šé‡‡æ ·åºå·ç»§ç»­æ¢å¤ï¼š
  - `./experiments/bin/run --name my_experiment --resume-from 3`
- åœ¨ç‰¹å®šæ‰§è¡Œç¯å¢ƒä¸­æ¢å¤åˆ°æŒ‡å®šé‡‡æ ·åºå·ï¼š
  - `./experiments/bin/run --name my_experiment --env-id my_experiment_20250828_052443 --resume-from 3`

è¯´æ˜ï¼š
- æœªæ˜¾å¼æŒ‡å®š `--env-id` æ—¶ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨é€‰æ‹©æœ€è¿‘çš„æ‰§è¡Œç¯å¢ƒã€‚
- æ¯æ¬¡æ–°çš„æ‰§è¡Œç¯å¢ƒä¼šä»¥ `my_experiment_YYYYMMDD_HHMMSS` çš„å½¢å¼åˆ›å»ºåœ¨ `experiments/env/` ä¸‹ã€‚

## spec.txt é…ç½®è¯´æ˜

### åŸºæœ¬é…ç½®

- **entrypoints**: è¦è¿è¡Œçš„å…¥å£ç‚¹åˆ—è¡¨ï¼Œæ”¯æŒä¸¤ç§ç±»å‹ï¼š
  - ä»¥ `.dph` ç»“å°¾çš„æ–‡ä»¶ï¼šä½œä¸ºè„šæœ¬æ–‡ä»¶è¿è¡Œï¼ˆä½¿ç”¨ `--file` å‚æ•°ï¼‰
  - å…¶ä»–åç§°ï¼šä½œä¸ºä»£ç†åç§°è¿è¡Œï¼ˆä½¿ç”¨ `--agent` å‚æ•°ï¼‰
- **configs**: é…ç½®å‚æ•°åˆ—è¡¨ï¼Œæ”¯æŒæ•°ç»„å½¢å¼è¿›è¡Œç»„åˆ
- **num_samples**: è¦è¿è¡Œçš„æ ·æœ¬æ•°é‡
- **sample_method**: é‡‡æ ·æ–¹æ³•ï¼Œç›®å‰æ”¯æŒ `SEQ`ï¼ˆé¡ºåºï¼‰
- **variables**: ä¼ é€’ç»™ç¨‹åºçš„å˜é‡
- **must_execute**: å¯é€‰ï¼Œå¿…é¡»æ‰§è¡Œçš„æŠ€èƒ½åˆ—è¡¨ï¼ˆå­—ç¬¦ä¸²æ•°ç»„ï¼‰ï¼Œæµ‹è¯•ç”¨ä¾‹å¦‚æœªè°ƒç”¨æŒ‡å®šæŠ€èƒ½å°†è¢«æ ‡è®°ä¸ºå¤±è´¥
- **dolphin_folder**: å¯é€‰ï¼ŒæŒ‡å®š Dolphin ä»£ç†æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆä¼ é€’ç»™ `--folder` å‚æ•°ï¼‰
- **threads**: å¯é€‰ï¼ŒæŒ‡å®šå¹¶å‘æ‰§è¡ŒåŸºå‡†æµ‹è¯•ç”¨ä¾‹çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º2

### é«˜çº§åŠŸèƒ½

#### 1. æŠ€èƒ½æ‰§è¡Œå¼ºåˆ¶çº¦æŸï¼ˆå¿…éœ€æŠ€èƒ½æ£€æŸ¥ï¼‰

é€šè¿‡ `must_execute` é…ç½®å¼ºåˆ¶è¦æ±‚æµ‹è¯•ç”¨ä¾‹å¿…é¡»è°ƒç”¨æŒ‡å®šçš„æŠ€èƒ½ï¼Œç¡®ä¿å®éªŒç»“æœçš„æœ‰æ•ˆæ€§ï¼š

```yaml
must_execute: ["executeSQL", "_cog_gen_sql", "_grep"]
```

**åŠŸèƒ½ç‰¹æ€§**ï¼š

- **è‡ªåŠ¨éªŒè¯**: ç³»ç»Ÿä¼šæ£€æŸ¥æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œè½¨è¿¹ï¼ˆ`_all_stages`ï¼‰ï¼Œç¡®è®¤æ˜¯å¦è°ƒç”¨äº†æ‰€æœ‰å¿…éœ€æŠ€èƒ½
- **å¤±è´¥æ ‡è®°**: å¦‚æœä»»ä½•å¿…éœ€æŠ€èƒ½æœªè¢«è°ƒç”¨ï¼Œè¯¥æµ‹è¯•ç”¨ä¾‹ä¼šè‡ªåŠ¨æ ‡è®°ä¸ºå¤±è´¥
- **è¯¦ç»†æŠ¥å‘Š**: åœ¨å®éªŒæŠ¥å‘Šä¸­æ˜¾ç¤ºå› ç¼ºå°‘å¿…éœ€æŠ€èƒ½è€Œå¤±è´¥çš„ç”¨ä¾‹æ•°é‡
- **æŠ€èƒ½è¿½è¸ª**: è®°å½•ç¼ºå¤±çš„å…·ä½“æŠ€èƒ½åç§°ï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# spec.txt
entrypoints: ["sql_agent"]
configs:
  - default: ["v3"]
variables:
  tools: ["[executeSQL, _cog_gen_sql, _grep]"]
must_execute: ["executeSQL"]  # å¼ºåˆ¶è¦æ±‚æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½å¿…é¡»æ‰§è¡ŒSQLæŸ¥è¯¢
benchmark: "bird_dev"
num_run_cases: 10
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```text
Must execute skills: ['executeSQL']
...
Run 1 Accuracy: 7/10 (70.0%)
  Warning: 2 cases failed due to missing must_execute skills

Overall Accuracy Report:
  Must Execute Skills: ['executeSQL']
  Total cases: 10
  Correct: 7 (70.0%)
  Failed: 1
  Failed due to missing skills: 2
```

**ä½¿ç”¨åœºæ™¯**ï¼š

- **SQL åŸºå‡†æµ‹è¯•**: ç¡®ä¿æ™ºèƒ½ä½“å¿…é¡»æ‰§è¡Œ SQL æŸ¥è¯¢è€Œä¸æ˜¯çŒœæµ‹ç­”æ¡ˆ
- **å·¥å…·ä½¿ç”¨éªŒè¯**: éªŒè¯æ™ºèƒ½ä½“æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº†ç‰¹å®šçš„å·¥å…·æˆ–æŠ€èƒ½
- **æµç¨‹åˆè§„æ£€æŸ¥**: ç¡®ä¿å…³é”®æ­¥éª¤åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¢«è·³è¿‡
- **è´¨é‡ä¿è¯**: æé«˜å®éªŒç»“æœçš„å¯é æ€§å’Œæœ‰æ•ˆæ€§

#### 2. æ•°ç»„é…ç½®å±•å¼€

configs æ”¯æŒæ•°ç»„å½¢å¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„ç»„åˆï¼š

```yaml
configs:
  - context_engineer.constraints.max_input_tokens: [64000, 32000]
    vm.host: [localhost, remote]
```

è¿™ä¼šç”Ÿæˆ 4 ä¸ªé…ç½®ç»„åˆï¼š

- `max_input_tokens: 64000, vm.host: localhost`
- `max_input_tokens: 64000, vm.host: remote`
- `max_input_tokens: 32000, vm.host: localhost`
- `max_input_tokens: 32000, vm.host: remote`

#### 3. åŸºå‡†æµ‹è¯•æ”¯æŒï¼ˆæ–°å¢å­—æ®µæ˜ å°„ä¸å‚æ•°é€ä¼ ï¼‰

åŸºå‡†æµ‹è¯•åç§°åœ¨ `spec.txt` ä¸­æŒ‡å®šï¼š

```yaml
benchmark: "browse_comp"
```

è¿™å°†ä» `experiments/benchmark/browse_comp/` åŠ è½½åŸºå‡†æ•°æ®å’Œé…ç½®ã€‚

benchmark.json é»˜è®¤å­—æ®µæ ¼å¼ï¼š

```json
[
  {
    "Topic": "ä¸»é¢˜",
    "Query": "é—®é¢˜å†…å®¹",
    "GoldLabel": "æ ‡å‡†ç­”æ¡ˆ",
    "canary": "æ ‡è¯†ç¬¦",
    "args": {
      "timeout": 30,
      "max_tokens": 1000
    }
  }
]
```

- **Query** ä¼šä½œä¸º `query` å˜é‡ä¼ é€’ç»™ç¨‹åº
- **args** å­—æ®µä¸­çš„å‚æ•°ä¼šç›´æ¥ä¼ é€’ç»™ `bin/dolphin` å‘½ä»¤ï¼ˆå¦‚ `--timeout 30 --max_tokens 1000`ï¼‰

æ”¯æŒæ—§æ•°æ®é›†å­—æ®µåï¼ˆä¾‹å¦‚ `Question`/`Answer`ï¼‰çš„æ˜ å°„ã€‚é€šè¿‡ `benchmark.yaml` çš„ `field_mapping` è¿›è¡Œé…ç½®ï¼š

```yaml
# experiments/benchmark/[benchmark_name]/benchmark.yaml
field_mapping:
  query_field: "Question"
  gold_label_field: "Answer"     # æˆ–ä½¿ç”¨æ‰©å±•æ ¼å¼ï¼Œè§ä¸‹æ–‡
  topic_field: "Topic"
```

GoldLabel æ”¯æŒæ‰©å±•çš„â€œç»“æ„åŒ–â€æ ¼å¼ï¼Œä¾¿äºæºå¸¦ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚æ•°æ®åº“ IDï¼‰ï¼š

```yaml
field_mapping:
  gold_label_field:
    result: "SQL"          # çœŸå®è¦æ¯”è¾ƒ/æ‰§è¡Œçš„ç»“æœå­—æ®µ
    context:
      db_id: "db_id"      # ä¸Šä¸‹æ–‡å­—æ®µæ˜ å°„ï¼ˆå¯é€‰ï¼Œå¯æ‰©å±•å¤šä¸ªé”®ï¼‰
```

æ­¤å¤–ï¼Œæ”¯æŒæŠŠæ ·æœ¬ä¸­çš„ä»»æ„å­—æ®µæ˜ å°„ä¸ºå‘½ä»¤è¡Œå‚æ•°ï¼ˆæ— éœ€æŠŠå®ƒä»¬éƒ½å¡è¿› `args`ï¼‰ï¼š

```yaml
field_as_args:
  timeout: "--timeout"   # æ ·æœ¬å­—æ®µå timeout å°†ä»¥ --timeout å½¢å¼ä¼ å‚
  max_tokens: "--max_tokens"
```

è¯´æ˜ï¼š

- æ ·æœ¬å†… `args` ä»ç„¶å—æ”¯æŒï¼Œä¸”ä¸ `field_as_args` åˆå¹¶ä¼ é€’ã€‚
- `benchmark.yaml` ä¸­çš„ `answer_variable` ä¸ `benchmark_comparator` ä¼šè¦†ç›– `spec.txt` ä¸­çš„åŒåé…ç½®ã€‚

#### 4. å˜é‡è¾“å‡ºè®°å½•ï¼ˆå«è¿›åº¦è·Ÿè¸ªï¼‰

é€šè¿‡ `output_variables` å­—æ®µæŒ‡å®šéœ€è¦è®°å½•çš„å˜é‡ï¼š

```yaml
output_variables: ["query", "result", "thought", "final_answer"]
```

ç³»ç»Ÿä¼šåœ¨ç¨‹åºæ‰§è¡Œå®Œæˆåæå–è¿™äº›å˜é‡çš„æœ€ç»ˆå€¼ï¼Œå¹¶è®°å½•åœ¨å®éªŒç»“æœä¸­ã€‚è¿™æ ·å¯ä»¥è¿½è¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å˜é‡çš„å˜åŒ–æƒ…å†µã€‚

æ–°å¢ï¼šç³»ç»Ÿä¼šå¼ºåˆ¶è¿½åŠ è¾“å‡ºå˜é‡ `_all_stages` ç”¨äºè¿›åº¦/é˜¶æ®µè·Ÿè¸ªã€‚è¿è¡Œç»“æŸåä¼šå°†é˜¶æ®µä¿¡æ¯ä¿å­˜åˆ°æ¯ä¸ªæ¡ˆä¾‹çš„ `history/case_XXX.jsonl` ä¸­ï¼Œä¾¿äºåˆ†æå™¨è¯»å–ä¸å¤ç›˜ã€‚

#### 5. åŸºå‡†å˜é‡å¯¹æ¯”ä¸é«˜çº§æ¯”è¾ƒ

åŸºå‡†æµ‹è¯•çš„å¯¹æ¯”å˜é‡åœ¨ `experiments/benchmark/[benchmark_name]/benchmark.yaml` ä¸­é…ç½®ï¼š

```yaml
# experiments/benchmark/browse_comp/benchmark.yaml
answer_variable: "final_result.answer"  # æ”¯æŒç‚¹å·åˆ†éš”çš„åµŒå¥—è®¿é—®
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ä»è¾“å‡ºå˜é‡ä¸­æå–æŒ‡å®šçš„å€¼ï¼Œå¹¶åœ¨å®éªŒç»“æœä¸­è®°å½•æ¯ä¸ªåŸºå‡†æµ‹è¯•é¡¹ç›®å¯¹åº”çš„ç»“æœå€¼ã€‚

#### 6. åŸºå‡†æµ‹è¯•æ¡ˆä¾‹é™åˆ¶

é€šè¿‡ `num_run_cases` å­—æ®µé™åˆ¶æ¯æ¬¡è¿è¡Œçš„åŸºå‡†æµ‹è¯•æ¡ˆä¾‹æ•°é‡ï¼š

```yaml
num_run_cases: 10  # åªè¿è¡Œå‰10ä¸ªåŸºå‡†æµ‹è¯•æ¡ˆä¾‹
```

è¿™å¯¹äºå¤§å‹åŸºå‡†æµ‹è¯•é›†åˆçš„å¿«é€ŸéªŒè¯æˆ–è°ƒè¯•éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥èŠ‚çœè¿è¡Œæ—¶é—´ã€‚

#### 7. æ™ºèƒ½åŸºå‡†æ¯”è¾ƒ

åŸºå‡†ç­”æ¡ˆçš„æ¯”è¾ƒæ–¹æ³•åœ¨ `benchmark.yaml` ä¸­é…ç½®ï¼š

```yaml
# experiments/benchmark/browse_comp/benchmark.yaml
benchmark_comparator: "model"  # ä½¿ç”¨ LLM è¿›è¡Œè¯­ä¹‰æ¯”è¾ƒ
```

æ”¯æŒçš„æ¯”è¾ƒæ–¹æ³•ï¼š

- **exact_match**: ç²¾ç¡®å­—ç¬¦ä¸²åŒ¹é…ï¼ˆé»˜è®¤ï¼‰
- **case_insensitive**: å¤§å°å†™ä¸æ•æ„Ÿçš„å­—ç¬¦ä¸²åŒ¹é…
- **model**: åŸºäº LLM çš„è¯­ä¹‰æ¯”è¾ƒ
- **custom**: ä½¿ç”¨åŸºå‡†æµ‹è¯•ç›®å½•ä¸­çš„è‡ªå®šä¹‰æ¯”è¾ƒå™¨

ä½¿ç”¨ `model` æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ LLM å¯¹é¢„æµ‹ç­”æ¡ˆå’Œæ ‡å‡†ç­”æ¡ˆè¿›è¡Œè¯­ä¹‰çº§åˆ«çš„æ¯”è¾ƒï¼Œèƒ½å¤Ÿè¯†åˆ«è¯­ä¹‰ç­‰ä»·ä½†è¡¨è¾¾æ–¹å¼ä¸åŒçš„ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•æ¯”ç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…æ›´å‡†ç¡®ï¼Œä½†ä¼šå¢åŠ è¿è¡Œæ—¶é—´å’Œ API è°ƒç”¨æˆæœ¬ã€‚

##### è‡ªå®šä¹‰æ¯”è¾ƒå™¨

ä½¿ç”¨ `custom` æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šåŠ è½½åŸºå‡†æµ‹è¯•ç›®å½•ä¸­çš„ `init.py` æ–‡ä»¶å¹¶è°ƒç”¨ `_comparator` å‡½æ•°ï¼š

```python
# experiments/benchmark/[benchmark_name]/init.py
def _comparator(golden, answer):
    """
    è‡ªå®šä¹‰æ¯”è¾ƒå™¨å‡½æ•°
    
    Args:
        golden: åŸºå‡†æµ‹è¯•ä¸­çš„æ ‡å‡†ç­”æ¡ˆï¼ˆå¯èƒ½æ˜¯ SQL æŸ¥è¯¢ç­‰ï¼‰
        answer: æ¨¡å‹é¢„æµ‹çš„ç­”æ¡ˆ
        
    Returns:
        bool: True è¡¨ç¤ºç­”æ¡ˆåŒ¹é…ï¼ŒFalse è¡¨ç¤ºä¸åŒ¹é…
    """
    # è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘
    return golden.strip().lower() == answer.strip().lower()
```

åœ¨è¿›å…¥ `_comparator` ä¹‹å‰ï¼Œç³»ç»Ÿè¿˜æ”¯æŒä»¥ä¸‹å¯é€‰â€œè½¬æ¢é’©å­â€ï¼Œç”¨äºå¯¹é»„é‡‘ç­”æ¡ˆã€é¢„æµ‹ç­”æ¡ˆã€æŸ¥è¯¢åšè§„èŒƒåŒ–å¤„ç†ï¼š

```python
# experiments/benchmark/[benchmark_name]/init.py

def _convert_gold_label(golden):
    # å°†é»„é‡‘æ•°æ®è½¬æ¢åˆ°è§„èŒƒæ ¼å¼ï¼ˆä¾‹å¦‚ï¼šæ‰§è¡Œ SQL å¹¶è¿”å›ç»“æ„åŒ–ç»“æœï¼‰
    return golden

def _convert_predicted(answer):
    # å°†æ¨¡å‹ç­”æ¡ˆè§£æ/è§„æ•´åˆ°å¯æ¯”è¾ƒçš„ç»“æ„ï¼ˆä¾‹å¦‚ï¼šast.literal_evalï¼‰
    return answer

def _convert_query(query):
    # å¦‚éœ€ï¼Œå¯¹ query åšåŒæ ·çš„å½’ä¸€åŒ–å¤„ç†
    return query
```

æœ‰äº†è¿™äº›è½¬æ¢é’©å­åï¼Œæ¯”è¾ƒå°†åŸºäºè½¬æ¢åçš„å€¼è¿›è¡Œï¼Œä»è€Œå¾—åˆ°æ›´ç¨³å¥çš„è¯„ä¼°ã€‚

è‡ªå®šä¹‰æ¯”è¾ƒå™¨ç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤æ‚éªŒè¯é€»è¾‘çš„åœºæ™¯ï¼Œå¦‚ï¼š

- SQL æŸ¥è¯¢ç»“æœæ¯”è¾ƒï¼šæ‰§è¡Œ SQL æŸ¥è¯¢å¹¶æ¯”è¾ƒç»“æœ
- æ•°å­¦è¡¨è¾¾å¼ç­‰ä»·æ€§éªŒè¯
- ç»“æ„åŒ–æ•°æ®æ ¼å¼éªŒè¯
- é¢†åŸŸç‰¹å®šçš„ç­”æ¡ˆéªŒè¯é€»è¾‘

##### SQL åŸºå‡†æµ‹è¯•ç¤ºä¾‹ï¼ˆå«è½¬æ¢é’©å­ï¼‰

ä»¥ä¸‹æ˜¯ä¸€ä¸ª SQL åŸºå‡†æµ‹è¯•çš„å®Œæ•´ç¤ºä¾‹ï¼š

```python
# experiments/benchmark/bird_dev/init.pyï¼ˆç®€åŒ–ç¤ºæ„ï¼‰
import ast
import yaml
from pathlib import Path
from DolphinLanguageSDK.ontology.datasource.sql import DataSourceSqlite

# è¯»å–å®éªŒé‡Œçš„ sqlite æ•°æ®æºé…ç½®
project_root = Path(__file__).resolve().parents[3]
global_config_path = project_root / "experiments" / "design" / "bird_baseline" / "config" / "global.yaml"
config = yaml.safe_load(global_config_path.read_text())
sqlite_sources = [ds for ds in config['ontology']['dataSources'] if ds['type'] == 'SQLITE']

def _convert_gold_label(gold):
    # gold å¯èƒ½æ˜¯ {result: SQL, context: {db_id: ...}} æˆ– SQL å­—ç¬¦ä¸²
    if isinstance(gold, dict):
        sql = str(gold.get('result', '')).strip()
        db_id = gold.get('context', {}).get('db_id')
    else:
        sql, db_id = str(gold).strip(), None

    # é€‰æ‹©æ•°æ®æºå¹¶æ‰§è¡Œ SQL
    ds_conf = next((s for s in sqlite_sources if s['name'] == db_id), sqlite_sources[-1])
    ds = DataSourceSqlite(ds_conf['name'], {'database': ds_conf['database']})
    ds.connect()
    rows = ds.executeQuery(sql).get('data', [])
    ds.close()
    return { 'sql': sql, 'db_id': db_id, 'result': [tuple(r) for r in rows] }

def _convert_predicted(ans):
    try:
        return ast.literal_eval(ans)
    except Exception:
        return ans

def _comparator(converted_gold, converted_pred):
    # æœŸæœ› compare çš„æ˜¯ç»“æ„åŒ–åˆ—è¡¨ï¼Œä¾‹å¦‚ [(1,), (2,)] vs [(id, 1), (id, 2)]
    gold = converted_gold.get('result', [])
    pred = converted_pred.get('data', converted_pred) if isinstance(converted_pred, dict) else converted_pred
    return gold == pred  # å¯æ›¿æ¢ä¸ºæ›´çµæ´»çš„æ¯”è¾ƒé€»è¾‘
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ï¼š

1. åŠ è½½å®éªŒçš„ SQLite æ•°æ®åº“é…ç½®
2. ä½¿ç”¨ dolphin-language çš„æœ¬ä½“æ•°æ®æºç±»æ‰§è¡Œ SQL æŸ¥è¯¢
3. å°†æŸ¥è¯¢ç»“æœä¸æ¨¡å‹é¢„æµ‹ç­”æ¡ˆè¿›è¡Œæ¯”è¾ƒ

å¦‚æœè‡ªå®šä¹‰æ¯”è¾ƒå™¨åŠ è½½å¤±è´¥æˆ–æ‰§è¡Œå‡ºé”™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°ç²¾ç¡®å­—ç¬¦ä¸²åŒ¹é…å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚

#### 8. Dolphin æ–‡ä»¶å¤¹é…ç½®

é€šè¿‡ `dolphin_folder` å­—æ®µæŒ‡å®š Dolphin ä»£ç†æ–‡ä»¶å¤¹è·¯å¾„ï¼š

```yaml
dolphin_folder: "/path/to/agents"  # æŒ‡å®šä»£ç†æ–‡ä»¶å¤¹è·¯å¾„
```

è¿™ä¸ªé…ç½®ä¼šä½œä¸º `--folder` å‚æ•°ä¼ é€’ç»™ `bin/dolphin` å‘½ä»¤ï¼Œç”¨äºæŒ‡å®šä»£ç†æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚

**é»˜è®¤è¡Œä¸º**ï¼šå¦‚æœæœªæŒ‡å®š `dolphin_folder`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å®éªŒè¿è¡Œç›®å½•ä¸­çš„ `dolphins/` æ–‡ä»¶å¤¹ä½œä¸ºé»˜è®¤æœç´¢è·¯å¾„ä¼ é€’ç»™ `--folder` å‚æ•°ã€‚è¿™ç¡®ä¿äº†ä»£ç†å’Œè„šæœ¬æ–‡ä»¶éƒ½èƒ½è¢«æ­£ç¡®æ‰¾åˆ°ã€‚

#### 9. å˜é‡æ•°ç»„å±•å¼€ï¼ˆæ–°å¢ï¼‰

`spec.txt` ä¸­çš„ `variables` ç°åœ¨æ”¯æŒæ•°ç»„å±•å¼€ï¼Œç³»ç»Ÿä¼šå¯¹æ•°ç»„å˜é‡åšç¬›å¡å°”ç§¯å¹¶ä¸é…ç½®ç»„åˆä¸€èµ·é‡‡æ ·ï¼š

```yaml
variables:
  query: ["é—®é¢˜ A", "é—®é¢˜ B"]
  style: ["ç®€æ´", "è¯¦ç»†"]
  temperature: 0.2   # éæ•°ç»„å˜é‡å°†å›ºå®šæ³¨å…¥
num_samples: 4       # å°†åŸºäºç»„åˆæ•°è‡ªåŠ¨è£å‰ª
sample_method: SEQ
```

å½“ä¸ `configs` çš„æ•°ç»„å±•å¼€å åŠ æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆç”Ÿæˆæ‰€æœ‰ç»„åˆï¼Œå†æ ¹æ® `num_samples` ä¸ `sample_method` è¿›è¡Œé‡‡æ ·ã€‚

å½“ä½¿ç”¨é `.dph` æ–‡ä»¶ä½œä¸ºå…¥å£ç‚¹æ—¶ï¼ˆå³ä»£ç†æ¨¡å¼ï¼‰ï¼Œæˆ–éœ€è¦æŒ‡å®šç‰¹å®šçš„ä»£ç†æ–‡ä»¶å¤¹è·¯å¾„æ—¶ï¼Œæ­¤é…ç½®ç‰¹åˆ«æœ‰ç”¨ã€‚

#### 10. å¹¶å‘æ‰§è¡Œæ”¯æŒï¼ˆæ–°å¢ï¼‰

å®éªŒç³»ç»Ÿæ”¯æŒå¹¶å‘æ‰§è¡ŒåŸºå‡†æµ‹è¯•ç”¨ä¾‹ï¼Œæ˜¾è‘—æå‡å¤§è§„æ¨¡æµ‹è¯•çš„è¿è¡Œæ•ˆç‡ã€‚

##### é…ç½®æ–¹æ³•

é€šè¿‡ `threads` å­—æ®µæŒ‡å®šå¹¶å‘çº¿ç¨‹æ•°ï¼š

```yaml
# spec.txt
entrypoints: ["explore_based"]
configs:
  - default: ["qwen-plus", "v3"]
benchmark: bird_dev
num_run_cases: 100
threads: 4                    # ä½¿ç”¨4ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
```

##### åŠŸèƒ½ç‰¹ç‚¹

- **é»˜è®¤å€¼**: å¦‚æœæœªæŒ‡å®š `threads`ï¼Œé»˜è®¤ä½¿ç”¨2ä¸ªçº¿ç¨‹
- **æ™ºèƒ½éªŒè¯**: æ— æ•ˆé…ç½®ï¼ˆå¦‚è´Ÿæ•°ã€éæ•°å­—ï¼‰ä¼šè‡ªåŠ¨å›é€€åˆ°é»˜è®¤å€¼2
- **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨çº¿ç¨‹é”ç¡®ä¿ç»“æœæ”¶é›†çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§
- **å®æ—¶åé¦ˆ**: å„æµ‹è¯•ç”¨ä¾‹çš„å®ŒæˆçŠ¶æ€ä¼šå®æ—¶æ˜¾ç¤º
- **é¡ºåºä¿è¯**: å¹¶å‘æ‰§è¡Œä¸ä¼šå½±å“ç»“æœçš„é¡ºåºï¼Œç¡®ä¿ä¸ä¸²è¡Œæ‰§è¡Œç»“æœä¸€è‡´

##### æ€§èƒ½æå‡

```yaml
# ç¤ºä¾‹ï¼š100ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ€§èƒ½å¯¹æ¯”
threads: 1    # ä¸²è¡Œæ‰§è¡Œï¼Œçº¦éœ€è¦ 100 åˆ†é’Ÿ
threads: 4    # å¹¶å‘æ‰§è¡Œï¼Œçº¦éœ€è¦ 25-30 åˆ†é’Ÿ  
threads: 8    # å¹¶å‘æ‰§è¡Œï¼Œçº¦éœ€è¦ 15-20 åˆ†é’Ÿ
```

å®é™…æ€§èƒ½æå‡å–å†³äºï¼š
- ç³»ç»ŸCPUæ ¸å¿ƒæ•°
- ç½‘ç»œå»¶è¿Ÿï¼ˆå¦‚LLM APIè°ƒç”¨ï¼‰
- æµ‹è¯•ç”¨ä¾‹çš„å¤æ‚åº¦
- ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡

##### ä½¿ç”¨å»ºè®®

1. **é€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ•°**: 
   - æ¨èå€¼ï¼šCPUæ ¸å¿ƒæ•°çš„1-2å€
   - é¿å…è®¾ç½®è¿‡é«˜å¯¼è‡´èµ„æºç«äº‰
   - è€ƒè™‘LLM APIçš„å¹¶å‘é™åˆ¶

2. **èµ„æºç›‘æ§**: 
   - ç›‘æ§CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µ
   - å…³æ³¨LLM APIçš„å¹¶å‘é™åˆ¶å’Œè´¹ç”¨
   - æ³¨æ„æ—¥å¿—æ–‡ä»¶çš„ç£ç›˜å ç”¨

3. **è°ƒè¯•å»ºè®®**: 
   - é¦–æ¬¡è¿è¡Œæ—¶ä½¿ç”¨è¾ƒå°çš„ `num_run_cases` å’Œ `threads` è¿›è¡Œæµ‹è¯•
   - å‡ºç°é—®é¢˜æ—¶å¯ä»¥è®¾ç½® `threads: 1` è¿›è¡Œä¸²è¡Œè°ƒè¯•
   - æŸ¥çœ‹å„ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ—¥å¿—æ–‡ä»¶å®šä½å…·ä½“é—®é¢˜

##### å…¼å®¹æ€§

- **å‘åå…¼å®¹**: ç°æœ‰çš„ `spec.txt` æ— éœ€ä¿®æ”¹å³å¯æ­£å¸¸è¿è¡Œ
- **é”™è¯¯å¤„ç†**: å•ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–ç”¨ä¾‹çš„æ‰§è¡Œ
- **æ—¥å¿—è®°å½•**: ä¿æŒåŸæœ‰çš„æ—¥å¿—æ ¼å¼å’Œé”™è¯¯æŠ¥å‘Šæœºåˆ¶

## å®éªŒç»“æœ

å®éªŒå®Œæˆåï¼Œç»“æœä¼šä¿å­˜åœ¨ `experiments/env/[experiment_name]_[timestamp]/` ç›®å½•ä¸‹ã€‚

æ¯ä¸ªè¿è¡Œï¼ˆRunï¼‰éƒ½ä¼šåœ¨å®éªŒç¯å¢ƒå†…åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç›®å½• `run_XXX/`ï¼Œå…¶ä¸­åŒ…å«æœ¬æ¬¡è¿è¡Œçš„æ‰€æœ‰äº§ç‰©ï¼š

- **run_summary.yaml**: è¯¥æ¬¡è¿è¡Œçš„è¯¦ç»†æ±‡æ€»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„é…ç½®ã€åŸºå‡†æµ‹è¯•ç»“æœã€ç²¾åº¦ç»Ÿè®¡ã€æ—¥å¿—æ–‡ä»¶è·¯å¾„ç­‰ã€‚
- **console/**: é€é¢˜æ§åˆ¶å°æ—¥å¿—ï¼ˆ`case_XXX.log`ï¼‰ï¼Œä¾¿äºå®šä½å•é¢˜é—®é¢˜ã€‚
- **profile/**: å½“å¯ç”¨ `--verbose` æ—¶ï¼Œç³»ç»Ÿä¼šå°† `data/profile/` ä¸­ç”Ÿæˆçš„æ€§èƒ½å‰–ææ–‡ä»¶æŒ‰ case å½’æ¡£è‡³æ­¤ç›®å½•ã€‚
- **config/**: åº”ç”¨äº†æœ¬æ¬¡è¿è¡Œç‰¹å®šé…ç½®çš„ `global.yaml`ã€‚
- **dolphins/**: å®éªŒä¸­ä½¿ç”¨çš„ DPH è„šæœ¬æ–‡ä»¶ã€‚
- **history/**: å¦‚æœè¿è¡Œäº†åŸºå‡†æµ‹è¯•ï¼Œè¿™é‡Œä¼šå­˜æ”¾æ¯ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼ˆcaseï¼‰çš„è¿‡ç¨‹è®°å½•ï¼ˆJSONL æ ¼å¼ï¼‰ã€‚é»˜è®¤å†™å…¥ `_all_stages` é˜¶æ®µä¿¡æ¯ï¼Œä¾¿äºåç»­åˆ†æä¸å¤ç›˜ã€‚
- **cmds/**: ä¸ºæ¯ä¸ª case è‡ªåŠ¨ç”Ÿæˆå¯é‡æ”¾çš„å‘½ä»¤è„šæœ¬ã€‚

### æ§åˆ¶å°è¾“å‡º

å®éªŒç»“æŸåï¼Œæ§åˆ¶å°ä¼šæ‰“å°æ€»ä½“æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š

- **æ€»ä½“ç²¾åº¦æŠ¥å‘Š**: è·¨æ‰€æœ‰è¿è¡Œçš„ç»¼åˆç²¾åº¦ç»Ÿè®¡ï¼ˆè‹¥é…ç½®åŸºå‡†ï¼‰ã€‚
- **è¿è¡Œå¯¹æ¯”è¡¨æ ¼**: æ¸…æ™°å±•ç¤ºæ¯ä¸ªè¿è¡Œçš„å…¥å£ã€é…ç½®ã€å‡†ç¡®ç‡ä¸æˆåŠŸçŠ¶æ€ï¼Œä¾¿äºå¿«é€Ÿæ¯”è¾ƒä¸åŒé…ç½®çš„æ€§èƒ½ã€‚
- **å˜é‡æå–æ€»ç»“**: å¦‚æœé…ç½®äº† `output_variables`ï¼Œä¼šæ˜¾ç¤ºå˜é‡æå–çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

æ­¤å¤–ï¼š

- **æ™ºèƒ½æ¯”è¾ƒ**: å¯¹è¯­ä¹‰ä»»åŠ¡ä½¿ç”¨ LLM æ¯”è¾ƒæä¾›æ›´é«˜å‡†ç¡®æ€§

## ä½¿ç”¨åœºæ™¯

### 1. é…ç½®å¯¹æ¯”å®éªŒ
æ¯”è¾ƒä¸åŒçš„æ¨¡å‹å‚æ•°ã€token é™åˆ¶ç­‰é…ç½®å¯¹ç»“æœçš„å½±å“ã€‚

### 2. åŸºå‡†æµ‹è¯•è¯„ä¼°
ä½¿ç”¨æ ‡å‡†åŒ–çš„é—®é¢˜é›†åˆè¯„ä¼°ç³»ç»Ÿæ€§èƒ½ï¼Œæ¯ä¸ªé—®é¢˜ç‹¬ç«‹è¿è¡Œå¹¶è®°å½•ç»“æœã€‚

### 3. å˜é‡è¿½è¸ªåˆ†æ
è®°å½•ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å…³é”®å˜é‡çš„å€¼ï¼Œç”¨äºåˆ†ææ¨ç†è¿‡ç¨‹å’Œç»“æœè´¨é‡ã€‚

### 4. å¤§è§„æ¨¡å®éªŒ
è‡ªåŠ¨åŒ–è¿è¡Œå¤§é‡é…ç½®ç»„åˆï¼Œæ”¶é›†ç»Ÿè®¡æ•°æ®è¿›è¡Œåˆ†æã€‚

### 5. æ™ºèƒ½ç­”æ¡ˆè¯„ä¼°
ä½¿ç”¨ LLM è¿›è¡ŒåŸºå‡†æµ‹è¯•ç­”æ¡ˆçš„è¯­ä¹‰æ¯”è¾ƒï¼Œæé«˜è¯„ä¼°å‡†ç¡®æ€§ã€‚é€‚ç”¨äºéœ€è¦ç†è§£ç­”æ¡ˆå«ä¹‰è€Œéä¸¥æ ¼åŒ¹é…çš„åœºæ™¯ã€‚

### 6. SQL æ•°æ®åº“åŸºå‡†æµ‹è¯•
é€šè¿‡è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ”¯æŒ SQL æŸ¥è¯¢ç»“æœæ¯”è¾ƒï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œ SQL è¯­å¥å¹¶éªŒè¯æŸ¥è¯¢ç»“æœçš„æ­£ç¡®æ€§ã€‚

### 7. Trajectory è½¨è¿¹è®°å½•ï¼ˆå®éªŒä¸“ç”¨ï¼‰

å½“åœ¨å®éªŒç¯å¢ƒä¸­å¼€å¯ `--verbose` æ¨¡å¼æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•è¯¦ç»†çš„æ‰§è¡Œè½¨è¿¹æ•°æ®ï¼Œç”¨äºåç»­åˆ†æå’Œå¤ç›˜ã€‚

#### Trajectory è®°å½•æœºåˆ¶

```bash
# è¿è¡Œå¸¦ verbose æ¨¡å¼çš„å®éªŒ
./experiments/bin/run --name my_experiment --verbose
```

å®éªŒç³»ç»Ÿä¼šä¸ºæ¯ä¸ªæµ‹è¯•æ¡ˆä¾‹åˆ›å»ºç‹¬ç«‹çš„è½¨è¿¹æ–‡ä»¶ï¼š

```text
experiments/env/[experiment_name]_[timestamp]/run_XXX/
â”œâ”€â”€ trajectory/                    # è½¨è¿¹æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ case_001.jsonl            # æ¡ˆä¾‹1çš„è½¨è¿¹æ•°æ®
â”‚   â”œâ”€â”€ case_002.jsonl            # æ¡ˆä¾‹2çš„è½¨è¿¹æ•°æ®
â”‚   â””â”€â”€ case_003.jsonl            # æ¡ˆä¾‹3çš„è½¨è¿¹æ•°æ®
â”œâ”€â”€ history/                      # å†å²è®°å½•ç›®å½•
â”‚   â”œâ”€â”€ case_001.jsonl            # æ¡ˆä¾‹1çš„è¿›åº¦è®°å½•
â”‚   â”œâ”€â”€ case_002.jsonl            # æ¡ˆä¾‹2çš„è¿›åº¦è®°å½•
â”‚   â””â”€â”€ case_003.jsonl            # æ¡ˆä¾‹3çš„è¿›åº¦è®°å½•
â””â”€â”€ cmds/                         # å‘½ä»¤è®°å½•ç›®å½•
    â”œâ”€â”€ cmd_case_001.sh           # æ¡ˆä¾‹1çš„æ‰§è¡Œå‘½ä»¤
    â”œâ”€â”€ cmd_case_002.sh           # æ¡ˆä¾‹2çš„æ‰§è¡Œå‘½ä»¤
    â””â”€â”€ cmd_case_003.sh           # æ¡ˆä¾‹3çš„æ‰§è¡Œå‘½ä»¤
```

#### Trajectory æ•°æ®æ ¼å¼

æ¯ä¸ª `.jsonl` æ–‡ä»¶åŒ…å«æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¯¦ç»†è½¨è¿¹ä¿¡æ¯ï¼Œå’Œä¸»æµæ¨¡å‹ä¿æŒä¸€è‡´ï¼ˆç›®å‰ä»…æ”¯æŒ explore æ¨¡å¼ï¼‰


#### ä½¿ç”¨åœºæ™¯

- **è°ƒè¯•åˆ†æ**ï¼šè¯¦ç»†æŸ¥çœ‹ç¨‹åºæ‰§è¡Œçš„æ¯ä¸€æ­¥ï¼Œå®šä½é—®é¢˜æ‰€åœ¨
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†ææ‰§è¡Œæ—¶é—´å’Œèµ„æºæ¶ˆè€—ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- **ç»“æœå¤ç°**ï¼šåŸºäºè½¨è¿¹æ•°æ®é‡ç°ç‰¹å®šçš„æ‰§è¡Œè·¯å¾„
- **è´¨é‡è¯„ä¼°**ï¼šåˆ†æä¸åŒé…ç½®ä¸‹çš„æ‰§è¡Œè´¨é‡å’Œç¨³å®šæ€§
- **æ¨¡å‹æ¯”è¾ƒ**ï¼šå¯¹æ¯”ä¸åŒæ¨¡å‹åœ¨ç›¸åŒä»»åŠ¡ä¸Šçš„è¡¨ç°å·®å¼‚

#### è‡ªåŠ¨å˜é‡æå–

ç³»ç»Ÿä¼šè‡ªåŠ¨æå–å…³é”®å˜é‡ï¼ˆåŒ…æ‹¬ `_all_stages`ï¼‰å¹¶ä¿å­˜åˆ° `history/` ç›®å½•ï¼Œä¾¿äºåç»­çš„åˆ†æå™¨è¯»å–å’Œå¤„ç†ã€‚è¿™äº›æ•°æ®æ”¯æŒï¼š

- è¿›åº¦è·Ÿè¸ªå’Œé˜¶æ®µåˆ†æ
- å˜é‡çŠ¶æ€å˜åŒ–è¿½è¸ª  
- é”™è¯¯å®šä½å’Œè°ƒè¯•æ”¯æŒ
- å®éªŒç»“æœçš„æ·±åº¦åˆ†æ

#### æ³¨æ„äº‹é¡¹

- Trajectory è®°å½•ä»…åœ¨å®éªŒç¯å¢ƒï¼ˆ`experiments/bin/run`ï¼‰ä¸­å¯ç”¨
- ç›´æ¥ä½¿ç”¨ `dolphin` å‘½ä»¤æ—¶éœ€æ‰‹åŠ¨æŒ‡å®š `--trajectorypath` å‚æ•°
- å¤§é‡çš„è½¨è¿¹æ•°æ®å¯èƒ½å ç”¨è¾ƒå¤šç£ç›˜ç©ºé—´ï¼Œå»ºè®®å®šæœŸæ¸…ç†æ—§çš„å®éªŒæ•°æ®

### 7. é«˜çº§è°ƒè¯•å’Œç›‘æ§
æ”¯æŒè¯¦ç»†çš„è¿è¡Œæ—¥å¿—ã€å˜é‡è¿½è¸ªå’Œè‡ªå®šä¹‰éªŒè¯é€»è¾‘ï¼Œä¾¿äºæ·±å…¥åˆ†æå®éªŒè¿‡ç¨‹å’Œç»“æœã€‚

### 8. æŠ€èƒ½æ‰§è¡Œåˆè§„éªŒè¯
é€šè¿‡å¿…éœ€æŠ€èƒ½æ£€æŸ¥ç¡®ä¿æ™ºèƒ½ä½“åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æ­£ç¡®æ‰§è¡Œäº†å…³é”®æ“ä½œï¼Œé¿å…é€šè¿‡çŒœæµ‹æˆ–è·³è¿‡æ­¥éª¤è·å¾—è™šå‡çš„é«˜åˆ†ã€‚ç‰¹åˆ«é€‚ç”¨äºSQLæŸ¥è¯¢ã€å·¥å…·è°ƒç”¨ã€APIè®¿é—®ç­‰éœ€è¦å®é™…æ‰§è¡Œçš„åœºæ™¯ã€‚

### 9. é«˜æ€§èƒ½å¹¶å‘å®éªŒ
åˆ©ç”¨å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œå¤§å¹…æå‡å®éªŒæ•ˆç‡ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤§è§„æ¨¡åŸºå‡†æµ‹è¯•ã€‚æ”¯æŒçµæ´»çš„çº¿ç¨‹æ•°é…ç½®å’Œå®æ—¶è¿›åº¦ç›‘æ§ï¼Œåœ¨ä¿è¯ç»“æœå‡†ç¡®æ€§çš„åŒæ—¶æ˜¾è‘—ç¼©çŸ­æ‰§è¡Œæ—¶é—´ã€‚

### 10. å®éªŒç»“æœåˆ†æ
ä½¿ç”¨å†…ç½®çš„åˆ†æå·¥å…·æ·±å…¥åˆ†æå®éªŒç»“æœï¼ŒåŒ…æ‹¬é…ç½®å¯¹æ¯”ã€æ¨¡å‹ä¸€è‡´æ€§åˆ†æã€é¢˜ç›®çº§åˆ«çš„è¯¦ç»†å¯¹æ¯”ç­‰ã€‚

### 11. è·¨runç³»ç»Ÿæ€§åˆ†æ
é€šè¿‡è·¨runåˆ†æåŠŸèƒ½è¯†åˆ«ç³»ç»Ÿæ€§é—®é¢˜ï¼Œç­›é€‰ä½æ­£ç¡®ç‡çš„ cases è¿›è¡Œæ·±å…¥åˆ†æï¼Œç”Ÿæˆè·¨ run çš„æ±‡æ€»æŠ¥å‘Šï¼Œè¯†åˆ«é«˜é¢‘é”™è¯¯æ¨¡å¼å’Œæ”¹è¿›æœºä¼šã€‚

## æœ€ä½³å®è·µ

1. **å®éªŒè®¾è®¡**: åœ¨ `design/` ç›®å½•ä¸‹åˆ›å»ºæ¸…æ™°å‘½åçš„å®éªŒ
2. **é…ç½®ç®¡ç†**: ä½¿ç”¨æ•°ç»„å½¢å¼ç®€åŒ–é‡å¤é…ç½®
3. **åŸºå‡†æµ‹è¯•**: ä½¿ç”¨æ ‡å‡†åŒ–çš„æµ‹è¯•é›†åˆç¡®ä¿å¯é‡å¤æ€§
4. **å˜é‡è®°å½•**: é€‰æ‹©å…³é”®å˜é‡è¿›è¡Œè¿½è¸ªï¼Œé¿å…è®°å½•è¿‡å¤šæ— å…³ä¿¡æ¯
5. **ç»“æœåˆ†æ**: åˆ©ç”¨ç”Ÿæˆçš„ YAML æ–‡ä»¶è¿›è¡Œåç»­æ•°æ®åˆ†æ
6. **æ™ºèƒ½æ¯”è¾ƒ**: å¯¹äºè¯­ä¹‰ç›¸å…³çš„ä»»åŠ¡ï¼Œä½¿ç”¨ LLM æ¯”è¾ƒæ–¹æ³•æé«˜è¯„ä¼°å‡†ç¡®æ€§
7. **æŠ€èƒ½çº¦æŸ**: ä½¿ç”¨ `must_execute` ç¡®ä¿å…³é”®æŠ€èƒ½çš„æ‰§è¡Œï¼Œæé«˜å®éªŒç»“æœçš„æœ‰æ•ˆæ€§
8. **å¹¶å‘æ‰§è¡Œ**: åˆç†è®¾ç½®çº¿ç¨‹æ•°æå‡å®éªŒæ•ˆç‡ï¼Œå»ºè®®ä»è¾ƒå°å€¼å¼€å§‹æµ‹è¯•

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®éªŒåˆ›å»ºå¤±è´¥**: æ£€æŸ¥ dolphins æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä¸”åŒ…å« .dph æ–‡ä»¶
2. **è¿è¡Œå¤±è´¥**: æŸ¥çœ‹å…·ä½“è¿è¡Œç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
3. **å˜é‡æå–å¤±è´¥**: ç¡®ä¿æŒ‡å®šçš„å˜é‡åœ¨ç¨‹åºä¸­ç¡®å®å­˜åœ¨
4. **åŸºå‡†æµ‹è¯•æ–‡ä»¶é”™è¯¯**: æ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®
5. **LLM æ¯”è¾ƒå¤±è´¥**: æ£€æŸ¥ LLM æœåŠ¡é…ç½®å’Œç½‘ç»œè¿æ¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°ç²¾ç¡®åŒ¹é…
6. **å‘½ä»¤è¡Œå‚æ•°è¯­æ³•é”™è¯¯**: å¦‚æœåŸºå‡†æµ‹è¯•æ•°æ®ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆæ‹¬å·ã€åå¼•å·ã€æ¢è¡Œç¬¦ç­‰ï¼‰ï¼Œå¯èƒ½å¯¼è‡´ shell è¯­æ³•é”™è¯¯ã€‚ç³»ç»Ÿå·²å¢å¼ºäº†å‚æ•°å¼•å·å¤„ç†æœºåˆ¶ï¼ˆå¯¹å¤æ‚å¯¹è±¡ä¼šè‡ªåŠ¨ JSON åºåˆ—åŒ–å¹¶åŠ å¼•å·ï¼‰ï¼Œä½†å¦‚æœä»ç„¶å‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ•°æ®ä¸­æ˜¯å¦åŒ…å«ä¸æ”¯æŒçš„ç‰¹æ®Šå­—ç¬¦
7. **è‡ªå®šä¹‰æ¯”è¾ƒå™¨é”™è¯¯**: æ£€æŸ¥ `init.py` æ–‡ä»¶ä¸­ `_comparator` å‡½æ•°çš„å®ç°ï¼Œç¡®ä¿è¿”å›å€¼ä¸ºå¸ƒå°”ç±»å‹
8. **å¿…éœ€æŠ€èƒ½æ£€æŸ¥é—®é¢˜**:
   - æŠ€èƒ½åç§°ä¸åŒ¹é…ï¼šç¡®ä¿ `must_execute` ä¸­çš„æŠ€èƒ½åç§°ä¸å®é™…æ‰§è¡Œçš„æŠ€èƒ½åç§°å®Œå…¨ä¸€è‡´
   - æŠ€èƒ½æœªæ‰§è¡Œï¼šæ£€æŸ¥æ™ºèƒ½ä½“é€»è¾‘ï¼Œç¡®ä¿åœ¨æ‰€éœ€åœºæ™¯ä¸‹ä¼šè°ƒç”¨æŒ‡å®šæŠ€èƒ½
   - è¯¯æŠ¥å¤±è´¥ï¼šæ£€æŸ¥ `_all_stages` è¾“å‡ºï¼Œç¡®è®¤æŠ€èƒ½ç¡®å®æœªè¢«è°ƒç”¨
9. **å¹¶å‘æ‰§è¡Œé—®é¢˜**:
   - çº¿ç¨‹æ•°è¿‡é«˜å¯¼è‡´èµ„æºç«äº‰ï¼šé™ä½ `threads` å€¼æˆ–è®¾ç½®ä¸º1è¿›è¡Œä¸²è¡Œè°ƒè¯•
   - éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼šæ£€æŸ¥å…·ä½“ç”¨ä¾‹çš„æ—¥å¿—æ–‡ä»¶ï¼ŒéªŒè¯LLM APIå¹¶å‘é™åˆ¶
   - ç»“æœé¡ºåºå¼‚å¸¸ï¼šç³»ç»Ÿå·²ä¿è¯ç»“æœé¡ºåºï¼Œå¦‚ä»æœ‰é—®é¢˜è¯·æ£€æŸ¥å¹¶å‘å®‰å…¨å®ç°

### è°ƒè¯•æ–¹æ³•

1. æŸ¥çœ‹ `experiment_run_X.log` äº†è§£è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
2. æ£€æŸ¥å„è¿è¡Œç›®å½•ä¸‹çš„ `run_summary.yaml` æ–‡ä»¶äº†è§£è¿è¡ŒçŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯
3. æ‰‹åŠ¨è¿è¡Œå•ä¸ªé…ç½®è¿›è¡Œè°ƒè¯•ï¼š

   ```bash
   cd experiments/env/[experiment_run]/run_001
   # å¯¹äº .dph è„šæœ¬æ–‡ä»¶
   ../../../../bin/dolphin --folder dolphins --file dolphins/main.dph --query "test"
   # å¯¹äºä»£ç†æ¨¡å¼
   ../../../../bin/dolphin --folder dolphins --agent agent_name --query "test"
   ```
4. æ£€æŸ¥å¯¹è¯å†å²æ–‡ä»¶ï¼ˆ`history/` ç›®å½•ï¼‰äº†è§£è¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹
5. ä½¿ç”¨ `--verbose` å‚æ•°è·å–æ›´è¯¦ç»†çš„è¿è¡Œä¿¡æ¯

## å®éªŒåˆ†æå·¥å…·

å®éªŒç³»ç»Ÿå†…ç½®äº†å¼ºå¤§çš„åˆ†æå·¥å…·ï¼Œå¯ä»¥å¯¹å®Œæˆçš„å®éªŒç»“æœè¿›è¡Œæ·±å…¥åˆ†æã€‚

### å¿«é€Ÿä½¿ç”¨

æ¨èä½¿ç”¨æ–°çš„ç»Ÿä¸€å…¥å£ `experiments/bin/analyst`ï¼š

```bash
# 1) æ€»ä½“åˆ†æï¼ˆé»˜è®¤/æ˜¾å¼ï¼‰â€”â€” ç”Ÿæˆç»¼åˆæŠ¥å‘Šä¸CSV
./experiments/bin/analyst my_experiment_20250901_120000
./experiments/bin/analyst my_experiment_20250901_120000 --general

# 2) æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼ˆå•é¢˜æ·±å…¥ï¼‰â€”â€” åŸºäº analysis.dph
./experiments/bin/analyst my_experiment_20250901_120000 --analysis --run run_001 --case 001

# 3) Summary åˆ†æï¼ˆæŒ‰ run æ±‡æ€» analysis ç»“æœï¼‰â€”â€” åŸºäº summary.dph
./experiments/bin/analyst my_experiment_20250901_120000 --analysis --run run_001 --summary

# ä¹Ÿå¯ä½¿ç”¨ç»å¯¹è·¯å¾„
./experiments/bin/analyst /full/path/to/experiments/env/my_experiment_20250901_120000 --general
```

è¯´æ˜ï¼š
- ä¼ å…¥ç›¸å¯¹è·¯å¾„æ—¶åŸºäº `experiments/env` è§£æï¼›ä¹Ÿæ”¯æŒç»å¯¹è·¯å¾„ã€‚
- `--analysis` éœ€é…åˆ `--run` å’Œ `--case`ï¼›`--summary` éœ€é…åˆ `--run`ã€‚

### åŠŸèƒ½ç‰¹ç‚¹

- **ğŸ” é…ç½®å¯¹æ¯”**: åˆ†æå„ä¸ªå®éªŒç»„çš„æ¨¡å‹é…ç½®å·®å¼‚
- **ğŸ“Š å‡†ç¡®ç‡ç»Ÿè®¡**: è®¡ç®—æ¯ä¸ªå®éªŒçš„æ­£ç¡®ç‡ã€é”™è¯¯ç‡
- **ğŸ¯ æ¨¡å‹åˆ†ç»„åˆ†æ**: æŒ‰æ¨¡å‹ç±»å‹åˆ†ç»„ï¼Œå¯¹æ¯”æ€§èƒ½
- **ğŸ”„ ä¸€è‡´æ€§åˆ†æ**: åˆ†æåŒä¸€æ¨¡å‹å¤šæ¬¡è¿è¡Œçš„ä¸€è‡´æ€§
- **ğŸ“‹ è¯¦ç»†é¢˜ç›®å¯¹æ¯”**: ç”Ÿæˆé€é¢˜å¯¹æ¯”è¡¨æ ¼ï¼ˆå«è½¬æ¢åå€¼ä¸æ¯”è¾ƒç»“æœï¼‰
- **ğŸ“ˆ ç¨³å®šæ€§æ’åº**: åŸºäºä¸€è‡´æ€§å¯¹æ¨¡å‹è¿›è¡Œç¨³å®šæ€§æ’åº
- **ğŸš¨ æ—¥å¿—é”™è¯¯åˆ†æ**: æ·±å…¥åˆ†æå®éªŒè¿è¡Œæ—¥å¿—ï¼Œè¯†åˆ«ç³»ç»Ÿæ€§é”™è¯¯
- **âš¡ è¿ç»­é”™è¯¯æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹è¿ç»­å¤±è´¥æ¨¡å¼ï¼Œè¯†åˆ«å¼‚å¸¸è¿è¡Œ
- **ğŸ’Š å¥åº·çŠ¶æ€è¯„ä¼°**: è¯„ä¼°å®éªŒè¿è¡Œå¥åº·çŠ¶æ€ï¼Œæä¾›ä¿®å¤å»ºè®®
- **ğŸ† æ™ºèƒ½ä½“æ‰§è¡Œåˆ†æ**: ä½¿ç”¨ LLM åˆ†ææ™ºèƒ½ä½“æ‰§è¡Œè¿‡ç¨‹ï¼Œå®šä½å…³é”®é—®é¢˜
- **ğŸ“š ä¸šåŠ¡çŸ¥è¯†é›†æˆ**: æ”¯æŒåŠ è½½å¤–éƒ¨çŸ¥è¯†æ–‡ä»¶ï¼Œå¢å¼ºåˆ†æå‡†ç¡®æ€§
- **ğŸ’¾ ç»“æœæŒä¹…åŒ–**: åˆ†æç»“æœè‡ªåŠ¨ä¿å­˜ï¼Œæ”¯æŒç¼“å­˜å’Œé‡ç”¨
- **ğŸ”„ æ‰¹é‡åˆ†æ**: è‡ªåŠ¨è¯†åˆ«å¤±è´¥ cases å¹¶è¿›è¡Œæ‰¹é‡åˆ†æ

### åˆ†ææ¨¡å¼

#### 1. æ€»ä½“åˆ†æï¼ˆGeneral Analysisï¼‰
ç”Ÿæˆå®éªŒçš„ç»¼åˆæŠ¥å‘Šï¼ŒåŒ…æ‹¬é…ç½®å¯¹æ¯”ã€å‡†ç¡®ç‡ç»Ÿè®¡ã€æ¨¡å‹ä¸€è‡´æ€§åˆ†æç­‰ã€‚

#### 2. æ‰§è¡Œåˆ†æï¼ˆExecution Analysisï¼‰
ä½¿ç”¨ LLM åˆ†ææ™ºèƒ½ä½“çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå®šä½å…³é”®é—®é¢˜å’Œæ”¹è¿›ç‚¹ã€‚æ”¯æŒå•ä¸ª case åˆ†æå’Œæ‰¹é‡åˆ†æã€‚

#### 3. Summary åˆ†æï¼ˆSummary Analysisï¼‰
æ±‡æ€»åˆ†ææŸä¸ª run ä¸‹çš„æ‰€æœ‰åˆ†æç»“æœï¼Œè¯†åˆ«é«˜é¢‘é—®é¢˜å’Œæ”¹è¿›å»ºè®®ã€‚

#### 4. è·¨runåˆ†æï¼ˆCross-Run Analysisï¼‰**ã€æ–°å¢ã€‘**
æ ¹æ®æ­£ç¡®ç‡é˜ˆå€¼ç­›é€‰é—®é¢˜ casesï¼Œè¿›è¡Œè·¨ run çš„ç³»ç»Ÿæ€§åˆ†æå’Œæ±‡æ€»ã€‚æ”¯æŒ `--case` ä»…å¯¹å•ä¸ª case åšè·¨ run æ±‡æ€»ã€‚

#### 5. æ¨¡æ‹Ÿæ³¨å…¥ï¼ˆSim Injectï¼‰**ã€æ–°å¢ã€‘**
è‡ªåŠ¨ä¸²è”è·¨runåˆ†æä¸æ³¨å…¥ç”Ÿæˆï¼Œè¿­ä»£è°ƒç”¨ `injects_deduce.dph` ä¸ºé¡½å›ºå¤±è´¥æ¡ˆä¾‹ç”Ÿæˆè¡¥æ•‘ Prompt/çŸ¥è¯†æ³¨å…¥å†…å®¹ï¼Œå¹¶åœ¨æ¯æ¬¡è¿­ä»£åä¸ benchmark åšå¯¹æ¯”æ ¡éªŒã€‚**ç°åœ¨æ”¯æŒæ‰¹é‡å¤„ç†**ï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†æ‰€æœ‰ä½å‡†ç¡®ç‡çš„casesæˆ–æŒ‡å®šå‡†ç¡®ç‡é˜ˆå€¼è¿›è¡Œæ‰¹é‡ä¼˜åŒ–ã€‚é€‚åˆéªŒè¯æ³¨å…¥ç­–ç•¥ã€æ¢å¤é•¿æœŸå¤±è´¥ caseï¼Œè¯¦æƒ…è§ `experiments/SIM_INJECT_USAGE.md`ã€‚

### ç”¨æ³•ç¤ºä¾‹

```bash
# 1) æ€»ä½“åˆ†æï¼ˆé»˜è®¤/æ˜¾å¼ï¼‰
./experiments/bin/analyst my_experiment_20250901_120000
./experiments/bin/analyst my_experiment_20250901_120000 --general

# 2) æ‰§è¡Œè¿‡ç¨‹åˆ†æ
# åˆ†æå•ä¸ª case
./experiments/bin/analyst my_experiment_20250901_120000 --analysis --run run_001 --case 001

# æ‰¹é‡åˆ†æå¤±è´¥çš„ cases
./experiments/bin/analyst my_experiment_20250901_120000 --analysis --run run_001

# ä½¿ç”¨ä¸šåŠ¡çŸ¥è¯†åˆ†æ
./experiments/bin/analyst my_experiment_20250901_120000 --analysis --run run_001 --knows knowledge.txt

# 3) Summary åˆ†æ
./experiments/bin/analyst my_experiment_20250901_120000 --analysis --run run_001 --summary

# 4) è·¨runåˆ†æï¼ˆæ–°åŠŸèƒ½ï¼‰
# åˆ†ææ­£ç¡®ç‡ä½äº30%çš„ cases
./experiments/bin/analyst my_experiment_20250901_120000 --cross-run-analysis --max-accuracy 30

# è·¨runåˆ†æå¹¶ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
./experiments/bin/analyst my_experiment_20250901_120000 --cross-run-analysis --max-accuracy 30 --summary

# ä½¿ç”¨ç‰¹å®šçš„CSVæ–‡ä»¶å’Œä¸šåŠ¡çŸ¥è¯†
./experiments/bin/analyst my_experiment_20250901_120000 --cross-run-analysis --max-accuracy 30 --summary --report-csv ./custom.csv --knows ./knowledge/

# ä»…é’ˆå¯¹å•ä¸ª case çš„è·¨runåˆ†æä¸æ±‡æ€»ï¼ˆæ”¯æŒ case_001 / 001 / 1ï¼‰
# æ³¨æ„ï¼šæŒ‡å®š --case æ—¶ä¸éœ€è¦ --max-accuracy å‚æ•°
./experiments/bin/analyst my_experiment_20250901_120000 --cross-run-analysis --summary --case 001
./experiments/bin/analyst my_experiment_20250901_120000 --cross-run-analysis --summary --report-csv ./custom.csv --case case_001

# 5) æ¨¡æ‹Ÿæ³¨å…¥ï¼ˆSim Injectï¼‰
# å•ä¸ªcaseå¤„ç†
./experiments/bin/analyst my_experiment_20250901_120000 --sim-inject --case_id 001 --knows knowledge/business_rules.txt --entrypoint custom_agent

# æ‰¹é‡å¤„ç†æ‰€æœ‰ä½äº10%å‡†ç¡®ç‡çš„casesï¼ˆé»˜è®¤é˜ˆå€¼ï¼‰
./experiments/bin/analyst my_experiment_20250901_120000 --sim-inject --knows knowledge/business_rules.txt --entrypoint custom_agent

# æ‰¹é‡å¤„ç†æ‰€æœ‰ä½äº30%å‡†ç¡®ç‡çš„cases
./experiments/bin/analyst my_experiment_20250901_120000 --sim-inject --accuracy-threshold 30 --max-iterations 10 --knows knowledge/business_rules.txt

# è‡ªå®šä¹‰è¿­ä»£æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´
./experiments/bin/analyst my_experiment_20250901_120000 --sim-inject --accuracy-threshold 20 --max-iterations 8 --sim-timeout 600
```

### è¾“å‡ºæ–‡ä»¶

- **æ€»ä½“åˆ†æ**ï¼š
  - `experiments/env/{experiment}/reports/{experiment}_general_report_{timestamp}.txt`
  - `experiments/env/{experiment}/reports/{experiment}_general_report_{timestamp}.csv`ï¼ˆåŒ…å«æ•´ä½“æ­£ç¡®ç‡åˆ—ï¼‰

- **æ‰§è¡Œåˆ†æ**ï¼š
  - ç»“æœç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°ï¼ˆæ ‡è®°ä¸º `===ANALYSIS_START=== ... ===ANALYSIS_END===`ï¼‰
  - è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ï¼š`experiments/env/{experiment}/{run}/analysis/case_XXX.txt`
  - æ”¯æŒç¼“å­˜ï¼Œå†æ¬¡åˆ†æåŒä¸€ case æ—¶ä¼šç›´æ¥ä½¿ç”¨å·²ä¿å­˜çš„ç»“æœ

- **Summary åˆ†æ**ï¼š
  - å°†ç»“è®ºå†™å…¥å¯¹åº” run ç›®å½•ï¼š`experiments/env/{experiment}/{run}/summary_result.txt`
  - åŸºäºå·²ä¿å­˜çš„åˆ†æç»“æœè¿›è¡Œæ±‡æ€»

- **è·¨runåˆ†æ**ï¼š
  - åˆ†æç»“æœä¿å­˜åˆ°å„ä¸ª run çš„ analysis ç›®å½•
  - æ±‡æ€»æŠ¥å‘Šï¼š`experiments/env/{experiment}/analysis/cross_run_summary_{timestamp}.txt`
  - åŒ…å«è·¨runçš„é«˜é¢‘é”™è¯¯åˆ†æã€é—æ¼ä¸šåŠ¡çŸ¥è¯†è¯†åˆ«å’Œæ”¹è¿›å»ºè®®
  - æ”¯æŒ `--case` é’ˆå¯¹å•ä¸€ case çš„è·¨ run æ±‡æ€»

- **æ¨¡æ‹Ÿæ³¨å…¥åˆ†æ**ï¼š
  - å•ä¸ªcaseæˆåŠŸæ³¨å…¥ï¼š`experiments/env/{experiment}/analysis/successful_inject_case_{case}.txt`
  - æ‰¹é‡å¤„ç†è¯¦ç»†æ±‡æ€»ï¼š`experiments/env/{experiment}/analysis/batch_sim_inject_summary_{timestamp}.txt`
  - **æ‰¹é‡å¤„ç†ç»¼åˆæŠ¥å‘Š**ï¼š`experiments/env/{experiment}/reports/{experiment_name}_sim_inject_report_{timestamp}.txt`
  - è¿­ä»£æ‰§è¡Œæ—¥å¿—ï¼š`experiments/env/{experiment}/simulation_logs/case_{case}_iter_{N}.log`

### Sim Inject å¿«é€Ÿè¯´æ˜

- **ä½¿ç”¨åœºæ™¯**: é’ˆå¯¹å¤šè½®è¿è¡Œä»å¤±è´¥çš„å›°éš¾ caseï¼Œé€šè¿‡è‡ªåŠ¨æ³¨å…¥è¡¥å……çŸ¥è¯†æˆ–æç¤ºè¯­æ¥æå‡æ­£ç¡®ç‡
- **æ”¯æŒæ¨¡å¼**:
  - **å•ä¸ªcase**: `--sim-inject --case_id <case>` å¤„ç†æŒ‡å®šcase
  - **æ‰¹é‡å¤„ç†**: `--sim-inject` è‡ªåŠ¨å¤„ç†æ‰€æœ‰ä½å‡†ç¡®ç‡casesï¼ˆé»˜è®¤â‰¤10%ï¼‰
  - **è‡ªå®šä¹‰é˜ˆå€¼**: `--sim-inject --accuracy-threshold <percent>` å¤„ç†ä½äºæŒ‡å®šé˜ˆå€¼çš„cases
- **æ ¸å¿ƒæµç¨‹**: è·¨ run è½¨è¿¹èšåˆ â†’ è°ƒç”¨ `injects_deduce.dph` çŒœæµ‹æ³¨å…¥å†…å®¹ â†’ è¿­ä»£æ‰§è¡Œå¹¶æ¯”è¾ƒ benchmark â†’ ç›´åˆ°è¾¾æˆæ­£ç¡®æˆ–è¶…å‡ºè¿­ä»£ä¸Šé™
- **é…ç½®é€‰é¡¹**:
  - `--max-iterations`: æ¯ä¸ªcaseçš„æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼ˆé»˜è®¤5ï¼‰
  - `--accuracy-threshold`: æ‰¹é‡å¤„ç†çš„å‡†ç¡®ç‡é˜ˆå€¼ï¼ˆé»˜è®¤10%ï¼‰
  - `--sim-timeout`: æ¯æ¬¡æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤500ç§’ï¼‰
  - `--knows`: ä¸šåŠ¡çŸ¥è¯†æ–‡ä»¶è·¯å¾„
  - `--entrypoint`: è‡ªå®šä¹‰æ‰§è¡Œå…¥å£ç‚¹
- **Agentçº¦æŸè¦æ±‚**:
  - **è¾“å‡ºå˜é‡çº¦æŸ**: ç³»ç»Ÿä¼šè‡ªåŠ¨å¼ºåˆ¶æ·»åŠ  `answer` è¾“å‡ºå˜é‡ï¼Œagentå¿…é¡»æ”¯æŒç”Ÿæˆç»“æ„åŒ–JSONè¾“å‡º
  - **injectå˜é‡çº¦æŸ**: `--entrypoint` æŒ‡å®šçš„agentå¿…é¡»æ”¯æŒæŒ‡å®šçš„injectå˜é‡ï¼ˆé»˜è®¤ä¸º `injects`ï¼‰ï¼Œå³agentæ–‡ä»¶ä¸­å¿…é¡»åŒ…å« `$injects` å˜é‡å¼•ç”¨
  - **æ–‡ä»¶å­˜åœ¨çº¦æŸ**: entrypointå¯¹åº”çš„ `.dph` æ–‡ä»¶å¿…é¡»å­˜åœ¨äºå®éªŒçš„ `dolphins/` ç›®å½•ä¸­
  - **å…¼å®¹æ€§ä¿è¯**: å¦‚æœæŒ‡å®šçš„entrypointä¸æ”¯æŒinjectå˜é‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ° `my_agent`
  - **Agentç¤ºä¾‹**: æ”¯æŒinjectçš„agentéœ€åœ¨DPHæ–‡ä»¶ä¸­å¼•ç”¨å˜é‡ï¼Œå¦‚ï¼š
    ```dolphin
    ã€é‡è¦æ³¨å…¥æç¤ºã€‘
    ```
    $injects
    ```
    ```
- **è¾“å‡ºäº§ç‰©**:
  - æˆåŠŸæ³¨å…¥å†…å®¹ï¼š`analysis/successful_inject_case_<case>.txt`
  - æ‰¹é‡å¤„ç†æ±‡æ€»ï¼š`analysis/batch_sim_inject_summary_<timestamp>.txt`
  - **ç»¼åˆåˆ†ææŠ¥å‘Š**ï¼š`reports/{experiment_name}_sim_inject_report_<timestamp>.txt`
  - è¿­ä»£æ—¥å¿—ï¼š`simulation_logs/case_<case>_iter_<N>.log`
- **å‰ç½®æ¡ä»¶**: ç›®æ ‡å®éªŒç¯å¢ƒéœ€åŒ…å«è‡³å°‘ä¸€ä¸ª `run_xxx` ç›®å½•ä¸æœ‰æ•ˆçš„ benchmark æ•°æ®ï¼›å»ºè®®å…ˆå®Œæˆè·¨runåˆ†æä»¥æä¾›å‚è€ƒ
- **æ›´å¤šèµ„æ–™**: è¯¦è§ `experiments/SIM_INJECT_USAGE.md`

### çŸ¥è¯†è·¯å¾„æŸ¥æ‰¾è§„åˆ™ï¼ˆ--knowsï¼‰
- ç›¸å¯¹è·¯å¾„æ—¶çš„æœç´¢é¡ºåºï¼š
  1) å• run çš„ Summary/æ‰§è¡Œåˆ†æï¼šä¼˜å…ˆ `{env}/{run}/<knows>`
  2) è®¾è®¡ç›®å½•ï¼š`experiments/design/{design_name}/<knows>`ï¼ˆå¦‚ watsons_baseline_20250914_XXXX -> è®¾è®¡å watsons_baselineï¼‰
  3) å®éªŒç¯å¢ƒæ ¹ç›®å½•ï¼š`{env}/<knows>`
  4) é¡¹ç›®æ ¹ç›®å½•ã€å½“å‰å·¥ä½œç›®å½•
- ç»å¯¹è·¯å¾„ï¼šç›´æ¥ä½¿ç”¨

### æŠ¥å‘Šå†…å®¹ç¤ºä¾‹

```text
å®éªŒåˆ†ææŠ¥å‘Š
============================================================
å®éªŒåç§°: bird_baseline_20250804_105810
åˆ†ææ—¶é—´: 2025-08-05 09:56:38

1. å®éªŒé…ç½®å¯¹æ¯”
------------------------------
 Run ID Default LLM           Model Name Cloud            Type API
run_001          k2 kimi-k2-0711-preview aishu aishu_model_factory
run_002    qwen-max    qwen-max-saas-ali aishu aishu_model_factory
run_003          v3      deepseek-v3-dip aishu aishu_model_factory
...

3. æŒ‰æ¨¡å‹åˆ†ç»„çš„å‡†ç¡®ç‡å¯¹æ¯”
------------------------------
kimi-k2-0711-preview:
  run_001: 59.00% (59/100)
  run_004: 25.25% (25/99)
  å¹³å‡å‡†ç¡®ç‡: 42.13%
  æœ€å¤§å·®å¼‚: 33.75%
...

4. ç›¸åŒæ¨¡å‹ä¸€è‡´æ€§åˆ†æ
------------------------------
kimi-k2-0711-preview æ¨¡å‹å¯¹æ¯” (run_001 vs run_004):
  æ€»é¢˜ç›®æ•°: 99
  ç»“æœä¸åŒ: 45
  ä¸€è‡´æ€§: 54.55%
...

5. åˆ†æç»“è®º
------------------------------
æ¨¡å‹ç¨³å®šæ€§æ’åºï¼ˆä¸€è‡´æ€§ä»é«˜åˆ°ä½ï¼‰ï¼š
1. deepseek-v3-dip: ä¸€è‡´æ€§ 74.00%
2. qwen-max-saas-ali: ä¸€è‡´æ€§ 69.70%
3. kimi-k2-0711-preview: ä¸€è‡´æ€§ 54.55%
```

### å…¸å‹ä½¿ç”¨åœºæ™¯

1. **æ¨¡å‹æ€§èƒ½å¯¹æ¯”**: æ¯”è¾ƒä¸åŒæ¨¡å‹åœ¨ç›¸åŒä»»åŠ¡ä¸Šçš„è¡¨ç°
2. **ç¨³å®šæ€§è¯„ä¼°**: è¯„ä¼°æ¨¡å‹è¾“å‡ºçš„å¯é æ€§å’Œä¸€è‡´æ€§
3. **å¼‚å¸¸æ£€æµ‹**: å‘ç°å®éªŒè¿‡ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µ
4. **ç»“æœåˆ†æ**: æ·±å…¥åˆ†æå®éªŒç»“æœï¼Œæ‰¾å‡ºé—®é¢˜æ‰€åœ¨
5. **å®éªŒæŠ¥å‘Š**: ç”Ÿæˆæ­£å¼çš„å®éªŒåˆ†ææŠ¥å‘Š
6. **æ™ºèƒ½ä½“æ‰§è¡Œè¯Šæ–­**: åˆ†æå•ä¸ª case çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå®šä½å…³é”®é—®é¢˜
7. **ä¸šåŠ¡çŸ¥è¯†è¾…åŠ©**: ç»“åˆä¸šåŠ¡çŸ¥è¯†è¿›è¡Œæ›´å‡†ç¡®çš„é—®é¢˜å®šä½
8. **æ‰¹é‡å¤„ç†**: è‡ªåŠ¨æ‰¹é‡åˆ†æå¤±è´¥çš„ casesï¼Œæé«˜åˆ†ææ•ˆç‡
9. **ç³»ç»Ÿæ€§é—®é¢˜è¯†åˆ«**: é€šè¿‡è·¨runåˆ†æè¯†åˆ«å½±å“å¤šä¸ª runs çš„ç³»ç»Ÿæ€§é—®é¢˜
10. **æ”¹è¿›ä¼˜å…ˆçº§æ’åº**: æ ¹æ®æ­£ç¡®ç‡é˜ˆå€¼ç­›é€‰æœ€éœ€è¦æ”¹è¿›çš„ cases

### è¿›é˜¶ç”¨æ³•

```bash
# ç›´æ¥ä½¿ç”¨ä¸»åˆ†æå™¨
cd experiments/analyst
python experiment_analyzer.py /full/path/to/experiment

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
python experiment_analyzer.py --help
```

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ `experiments/analyst/README.md` ä¸ `experiments/bin/README.md`ï¼ˆè¿è¡Œç®¡ç†é€ŸæŸ¥ï¼‰ã€‚

## æ›´æ–°æ—¥å¿—

### v0.2.6 (æœ€æ–°)
- **å¿…éœ€æŠ€èƒ½æ£€æŸ¥åŠŸèƒ½**: æ–°å¢ `must_execute` é…ç½®é¡¹ï¼Œå¼ºåˆ¶è¦æ±‚æµ‹è¯•ç”¨ä¾‹è°ƒç”¨æŒ‡å®šæŠ€èƒ½
- **æŠ€èƒ½æ‰§è¡ŒéªŒè¯**: è‡ªåŠ¨æ£€æŸ¥ `_all_stages` ä¸­çš„æŠ€èƒ½æ‰§è¡Œæƒ…å†µï¼Œæœªè°ƒç”¨å¿…éœ€æŠ€èƒ½çš„ç”¨ä¾‹è‡ªåŠ¨æ ‡è®°ä¸ºå¤±è´¥
- **è¯¦ç»†æŠ€èƒ½æŠ¥å‘Š**: åœ¨å®éªŒæŠ¥å‘Šä¸­æ˜¾ç¤ºå› ç¼ºå°‘å¿…éœ€æŠ€èƒ½è€Œå¤±è´¥çš„ç”¨ä¾‹æ•°é‡å’Œå…·ä½“ç¼ºå¤±æŠ€èƒ½
- **è´¨é‡ä¿è¯å¢å¼º**: æé«˜å®éªŒç»“æœçš„æœ‰æ•ˆæ€§ï¼Œé˜²æ­¢æ™ºèƒ½ä½“é€šè¿‡çŒœæµ‹æˆ–è·³è¿‡å…³é”®æ­¥éª¤è·å¾—è™šå‡é«˜åˆ†

### v0.2.5
- **è·¨runåˆ†æåŠŸèƒ½**: æ–°å¢ --cross-run-analysis æ¨¡å¼ï¼Œæ ¹æ®æ­£ç¡®ç‡é˜ˆå€¼ç­›é€‰é—®é¢˜ cases
- **è·¨runæ±‡æ€»åˆ†æ**: æ”¯æŒ --cross-run-analysis --summaryï¼Œç”Ÿæˆè·¨ run çš„ç³»ç»Ÿæ€§åˆ†ææŠ¥å‘Š
- **æ•´ä½“æ­£ç¡®ç‡ç»Ÿè®¡**: CSV æŠ¥å‘Šæ–°å¢"æ•´ä½“æ­£ç¡®ç‡"åˆ—ï¼Œç»Ÿè®¡æ¯ä¸ª case åœ¨æ‰€æœ‰ runs ä¸­çš„æ­£ç¡®ç‡
- **æŠ¥å‘Šæœ¬åœ°åŒ–**: æ‰€æœ‰åˆ†ææŠ¥å‘Šä¿å­˜åœ¨å®éªŒç›®å½•ä¸‹çš„ reports å’Œ analysis æ–‡ä»¶å¤¹
- **Summary åˆ†æä¼˜åŒ–**: ç§»é™¤å¯¹ _read_folder çš„ä¾èµ–ï¼Œåœ¨å¤–éƒ¨è§£æåˆ†ææ–‡ä»¶å†…å®¹
- **æ™ºèƒ½CSVå‘ç°**: --cross-run-analysis è‡ªåŠ¨æŸ¥æ‰¾æœ€æ–°çš„ general report CSV æ–‡ä»¶
- **å‚æ•°éªŒè¯ä¼˜åŒ–**: --cross-run-analysis åœ¨æœªæŒ‡å®š --case æ—¶è¦æ±‚ --max-accuracy å‚æ•°ï¼›æŒ‡å®š --case æ—¶è‡ªåŠ¨ä½¿ç”¨ 100% é˜ˆå€¼

### v0.2.4
- **æ™ºèƒ½åŒ–åˆ†æç³»ç»Ÿ**: é‡æ„å®éªŒåˆ†æå·¥å…·ï¼Œæ”¯æŒæ™ºèƒ½ä½“æ‰§è¡Œåˆ†æ
- **ä¸šåŠ¡çŸ¥è¯†é›†æˆ**: æ–°å¢ --knows å‚æ•°ï¼Œæ”¯æŒåœ¨åˆ†æå’Œæ±‡æ€»é˜¶æ®µåŠ è½½å¤–éƒ¨çŸ¥è¯†æ–‡ä»¶
- **æ‰¹é‡åˆ†æåŠŸèƒ½**: è‡ªåŠ¨è¯†åˆ«å’Œæ‰¹é‡åˆ†æå¤±è´¥çš„ cases
- **ç»“æœæŒä¹…åŒ–**: åˆ†æç»“æœè‡ªåŠ¨ä¿å­˜ï¼Œæ”¯æŒç¼“å­˜å’Œé‡ç”¨
- **ç»Ÿä¸€å…¥å£**: experiments/bin/analyst æä¾›ç»Ÿä¸€çš„åˆ†æå…¥å£
- **æ ‡å‡†åŒ–è¾“å‡º**: ä½¿ç”¨ ===ANALYSIS_START=== å’Œ ===ANALYSIS_END=== æ ‡è®°åŒ…å›´ç»“æœ
- **çŸ¥è¯†å¢å¼ºæ±‡æ€»**: Summary åˆ†ææ”¯æŒä¸šåŠ¡çŸ¥è¯†ï¼Œæä¾›æ›´ç²¾å‡†çš„æ”¹è¿›å»ºè®®

### v0.2.3
- **å®éªŒç³»ç»Ÿå¹¶å‘æ”¯æŒ**: æ–°å¢å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡ŒåŸºå‡†æµ‹è¯•ç”¨ä¾‹çš„åŠŸèƒ½
- **æ€§èƒ½ä¼˜åŒ–**: é€šè¿‡å¹¶å‘æ‰§è¡Œå¤§å¹…æå‡å¤§è§„æ¨¡å®éªŒçš„è¿è¡Œæ•ˆç‡
- **é…ç½®å¢å¼º**: spec.txt æ”¯æŒ threads é…ç½®é¡¹ï¼Œå¯æŒ‡å®šå¹¶å‘çº¿ç¨‹æ•°
- **çº¿ç¨‹å®‰å…¨**: å®ç°çº¿ç¨‹å®‰å…¨çš„ç»“æœæ”¶é›†æœºåˆ¶ï¼Œç¡®ä¿ç»“æœä¸€è‡´æ€§
- **å‘åå…¼å®¹**: ç°æœ‰å®éªŒé…ç½®æ— éœ€ä¿®æ”¹å³å¯æ­£å¸¸è¿è¡Œ

### v0.2.2
- docs: add comprehensive CHANGELOG for v0.2.2
- Document new Explore Block v2 with deduplication and performance improvements
- Include experiment analyzer enhancements and SQL skillkit improvements
- Add CLI parameter updates (dialogpath â†’ trajectorypath)
- Provide usage guide for explore_v2 with practical examples
- Cover architectural changes and technical implementation details

Features:
- New explore_block_v2.py with intelligent deduplication (DeduplicatorSkillCall)
- Enhanced experiment analyzer with run labeling and smart filtering
- Performance optimizations and improved error handling
- OpenAI tool call format support
- System function unit tests

Breaking Changes:
- CLI parameter --dialogpath renamed to --trajectorypath
- New deduplication enabled by default (max 5 retries)
